From a915ac261db642a8ec7921f548a8aeadee63af81 Mon Sep 17 00:00:00 2001
From: Steven Fisher <steven.fisher@globalinvacom.com>
Date: Fri, 30 Jun 2017 15:58:42 -0400
Subject: [PATCH] Enable System DL

---
 contrib/src/ffmpeg/patch-as-patch-can.patch | 20 ++++++++++++++++++++
 contrib/src/ffmpeg/rules.mak                |  6 +++++-
 2 files changed, 25 insertions(+), 1 deletion(-)
 create mode 100644 contrib/src/ffmpeg/patch-as-patch-can.patch

diff --git a/contrib/src/ffmpeg/patch-as-patch-can.patch b/contrib/src/ffmpeg/patch-as-patch-can.patch
new file mode 100644
index 0000000000..2d60cf7140
--- /dev/null
+++ b/contrib/src/ffmpeg/patch-as-patch-can.patch
@@ -0,0 +1,20 @@
+Only in ffmpeg: .DS_Store
+diff -ru ffmpeg/libavcodec/audiotoolboxdec.c ffmpeg-fix/libavcodec/audiotoolboxdec.c
+--- ffmpeg/libavcodec/audiotoolboxdec.c	2016-05-09 11:44:29.000000000 +0200
++++ ffmpeg-fix/libavcodec/audiotoolboxdec.c	2016-05-09 14:01:04.000000000 +0200
+@@ -345,7 +345,6 @@
+         avctx->bit_rate = bit_rate;
+         in_format.mSampleRate = avctx->sample_rate;
+ #endif
+-#if CONFIG_AC3_AT_DECODER || CONFIG_EAC3_AT_DECODER
+     } else if (pkt && pkt->size >= 7 &&
+                (avctx->codec_id == AV_CODEC_ID_AC3 ||
+                 avctx->codec_id == AV_CODEC_ID_EAC3)) {
+@@ -358,7 +357,6 @@
+         in_format.mChannelsPerFrame = hdr.channels;
+         avctx->frame_size = hdr.num_blocks * 256;
+         avctx->bit_rate = hdr.bit_rate;
+-#endif
+     } else {
+         in_format.mSampleRate = avctx->sample_rate ? avctx->sample_rate : 44100;
+         in_format.mChannelsPerFrame = avctx->channels ? avctx->channels : 1;
diff --git a/contrib/src/ffmpeg/rules.mak b/contrib/src/ffmpeg/rules.mak
index 1099f5dd52..6f604b597f 100644
--- a/contrib/src/ffmpeg/rules.mak
+++ b/contrib/src/ffmpeg/rules.mak
@@ -5,7 +5,7 @@
 USE_FFMPEG ?= 1
 
 ifdef USE_FFMPEG
-FFMPEG_HASH=0768aaec1d683226e613e692080a588359c31334
+FFMPEG_HASH=911417f0b34e611bf084319c5b5a4e4e630da940
 FFMPEG_SNAPURL := http://git.videolan.org/?p=ffmpeg.git;a=snapshot;h=$(FFMPEG_HASH);sf=tgz
 FFMPEG_GITURL := http://git.videolan.org/git/ffmpeg.git
 else
@@ -24,6 +24,9 @@ FFMPEGCONF = \
 	--disable-decoder=opus \
 	--enable-libgsm \
 	--enable-libopenjpeg \
+	--disable-decoder=mlp \
+	--disable-demuxer=mlp \
+	--disable-parser=mlp \
 	--disable-debug \
 	--disable-avdevice \
 	--disable-devices \
@@ -228,6 +231,7 @@ ifdef USE_FFMPEG
 	$(APPLY) $(SRC)/ffmpeg/force-unicode.patch
 	$(APPLY) $(SRC)/ffmpeg/libs.patch
 endif
+	$(APPLY) $(SRC)/ffmpeg/patch-as-patch-can.patch
 	$(MOVE)
 
 .ffmpeg: ffmpeg
-- 
2.11.0 (Apple Git-81)

